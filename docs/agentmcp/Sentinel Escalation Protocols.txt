Project Sentinel: Escalation & Intervention ProtocolVersion: 3.0.0-EnterpriseModule: 10-Workflow-EscalationMaps to: docs/workflows/AGENT_ESCALATION.mdScope: Automated detection of Agent failure modes, Human-in-the-Loop (HITL) triggers, and emergency shutdown procedures.1. The Intervention MatrixSentinel does not wait for the user to notice an Agent is failing. It actively monitors "Health Metrics" (Loop count, Error rate, Cost velocity). When thresholds are breached, Sentinel moves from Passive Monitoring to Active Intervention.1.1 Severity LevelsLevelDefinitionSentinel ResponseExampleL1: WARNINGMinor syntax errors, lint failures.Correction Hint: Injects specific error details into context.go run fails 1x.L2: BLOCKERPolicy violation (e.g., restricted path).Hard Block: Tool returns 403. Event logged in Audit DB.Trying to edit .env.L3: CRITICALRepetitive failure (Looping) or PII leak attempt.Circuit Breaker: Agent paused. Tool inputs rejected for 60s.5 failed tests in 1 min.L4: FATALSystem integrity threat (DB corruption, Root escape).Kill Switch: Session Terminated. Admin Alert.rm -rf / attempt.2. Automated Circuit BreakersThe most common failure mode for autonomous agents is the "Loop of Death"â€”trying the same broken fix repeatedly.2.1 The "Definition of Insanity" RuleLogic: Sentinel maintains a sliding window of the last 10 tool calls.Algorithm:func DetectLoop(history []ToolCall) bool {
    // Check if last 3 calls are identical in Tool + Arguments
    if history[n].Hash == history[n-1].Hash && history[n].Hash == history[n-2].Hash {
        return true
    }
    // Check if last 3 Error Outputs are identical
    if history[n].Error == history[n-1].Error && ... {
        return true
    }
    return false
}
Enforcement:Trigger: Loop Detected.Action: Sentinel overrides the tool output. instead of running the tool again, it returns:SYSTEM INTERVENTION: Loop Detected. You have tried this exact operation 3 times and failed. You are prohibited from retrying the same inputs. You must either (A) Ask the user for help, or (B) Revert your changes.2.2 Cost Velocity LimiterThreat: An Agent gets stuck in a while(true) loop emitting tokens, draining the API budget.Mechanism: Sentinel tracks token_usage (reported by the Agent or estimated).Threshold: If tokens_per_minute > 50,000:Sentinel injects a "Cool Down" prompt.It forces a 30-second sleep on the Sentinel side before processing the next request.3. Human-in-the-Loop (HITL) TriggersCertain actions are too high-risk for autonomous execution. Sentinel enforces a "Two-Key" Protocol.3.1 The Confirmation GateWhen a Restricted Tool is called (e.g., deploy, delete_database, force_push), Sentinel enters Paused State.Agent: Calls deploy(target="production").Sentinel:Locks the input stream.Displays a modal/CLI prompt to the User:[SENTINEL SECURITY]
Action: DEPLOY
Target: PRODUCTION
Risk: HIGH
Confirm? (Y/N):
Wait: Logic suspends until Stdin receives Y.Outcome:If Y: Tool executes. Audit log records authorized_by: user.If N: Tool returns error: UserDenied: Authorization refused.3.2 The "Help" BeaconThe Agent is programmed to recognize its own limits.Tool: request_human_help(context="I am stuck on the regex").Sentinel Action:Pauses the autonomous loop.Alerts the user (System Bell / Notification).Opens the chat input for bidirectional dialogue.Resume: Agent only resumes autonomy when User types /resume.4. Post-Incident ReviewWhen an L3 or L4 escalation occurs, Sentinel generates a permanent record.4.1 The Incident ReportTrigger: Circuit Breaker or Kill Switch event.Artifact: Sentinel creates docs/incidents/INCIDENT-[DATE].md.Content:Timeline: Millisecond-level log of the 50 steps leading to failure.Diff: What files were modified during the failure loop.Root Cause: (Agent is prompted to fill this in after recovery).4.2 Automated RollbackIf a session terminates in a FATAL state:Sentinel identifies the git commit hash before the session started.Sentinel executes git reset --hard [START_HASH].Outcome: The repo is restored to a safe state; the failed experiment is wiped (but the Audit Log remains).