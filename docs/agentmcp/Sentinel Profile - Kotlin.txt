Project Sentinel: Kotlin Language ProfileVersion: 3.0.0-EnterpriseModule: 35-Lang-KotlinMaps to: examples/kotlin/Scope: Active enforcement of Android security, Coroutines best practices, Gradle DSL standards, and Multiplatform (KMP) isolation.1. The Gradle Toolchain (Kotlin DSL)Sentinel enforces the use of the Kotlin DSL (build.gradle.kts) over Groovy for type safety and better IDE support for Agents.1.1 The Dependency VerificationRule: Checksums for all dependencies.Enforcement:Sentinel activates Gradle's dependency-verification mode.If the Agent adds a library (e.g., via implementation(...)) without updating gradle/verification-metadata.xml, the build fails.Auto-Fix: Sentinel runs gradle --write-verification-metadata sha256 automatically when new valid dependencies are approved.1.2 Plugin ManagementThreat: Malicious Gradle plugins.Enforcement:Sentinel restricts the plugins {} block.Only plugins from plugins.gradle.org or authorized internal registries are allowed.Block: Usage of http:// repositories is strictly forbidden.2. Coroutines SafetyKotlin Coroutines are powerful but prone to blocking the UI thread or leaking jobs.2.1 Blocking Call DetectionRule: No blocking I/O in Dispatchers.Main.Enforcement:Sentinel uses BlockHound (if configured) or static analysis (detekt).Check: Calls to Thread.sleep, InputStream.read, or Database ops inside a suspend function without withContext(Dispatchers.IO).Action: BLOCKED.Message: "Thread Starvation Risk: Blocking call detected in potential UI context. Wrap in withContext(Dispatchers.IO)."2.2 Structured ConcurrencyRule: No GlobalScope.Enforcement:Sentinel greps for GlobalScope.launch.Action: BLOCKED.Message: "Leak Risk: GlobalScope is discouraged. Use viewModelScope, lifecycleScope, or a structured CoroutineScope."3. Static Analysis (detekt / ktlint)Sentinel mandates strict adherence to Kotlin idioms.3.1 Formatting (ktlint)Rule: Standard Kotlin coding conventions.Enforcement:Sentinel runs ktlint on save.Check: Trailing commas, wildcard imports.Action: Auto-format applied.3.2 Code Smell Analysis (detekt)Rule: Low cognitive complexity.Enforcement:Check: LongMethod, NestedBlockDepth.Magic Numbers: If the Agent uses hardcoded values (e.g., delay(500)), detekt flags it.Action: Sentinel prompts the Agent to extract constants: private const val ANIMATION_DELAY = 500L.4. Android Specific GuardrailsFor Agents working on mobile apps.4.1 Manifest SecurityThreat: Exported activities.Enforcement:Sentinel scans AndroidManifest.xml.Check: <activity android:exported="true"> without a permission.Action: CRITICAL BLOCK.Message: "Security Risk: Exported activity is accessible to other apps. Set exported=false or require a permission."4.2 ProGuard/R8 RulesRule: No generic keep rules.Enforcement:Sentinel analyzes proguard-rules.pro.Bad: -keep class com.myapp.** { *; } (Disables obfuscation).Action: Rejects the rule change.Prompt: "Obfuscation Warning: Your keep rule is too broad. Be specific."5. Server-Side Kotlin (Ktor / Spring)5.1 Serialization SafetyRule: Use kotlinx.serialization safely.Enforcement:Sentinel checks for @Serializable classes.Check: If a class has default values for security-critical fields (e.g., val isAdmin: Boolean = false), Sentinel ensures the default is safe.If val isAdmin: Boolean = true is found -> BLOCKED.5.2 Ktor RoutingRule: Type-safe routing.Enforcement:Sentinel encourages usage of Resources (Type-safe routing) over raw string paths.Warning: "Consider using Ktor Type-Safe Routing for better maintainability."6. Troubleshooting Kotlin Agents6.1 Common Failure Modes"Unresolved Reference: R": Agent modified a resource XML but R.java didn't regenerate.Sentinel Fix: Runs a clean build or specifically targets the resource compiler task."KAPT/KSP Error": Annotation processing failed.Sentinel Fix: Parses the verbose Gradle output (which is often hidden) and presents the specific annotation error (e.g., "Room: Entity needs a primary key") to the Agent.