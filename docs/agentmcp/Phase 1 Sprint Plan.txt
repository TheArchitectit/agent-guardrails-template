Project Sentinel: Phase 1 - Kernel FoundationTarget Agent: Autonomous Developer (Go Expert)Total Estimated Tokens: 120kOutput Artifact: bin/sentinel (Basic Version)Dependencies: Go 1.23+, modernc.org/sqlite, mark3labs/mcp-go0. Phase Overview & Architecture RetrievalContext:We are building Project Sentinel, a Model Context Protocol (MCP) server that acts as a guardrail for AI Agents.Refer to docs/SENTINEL_ARCH.md and docs/SENTINEL_CORE_ARCH.md for the blueprint.Primary Objective:Build the "Immutable Core" of the system. This includes the process lifecycle, the database layer (SQLite), and the security boundary (VFS Jail). By the end of this phase, the Agent should be able to run sentinel init to create the DB and sentinel serve to listen for basic MCP requests, although no complex tools will work yet.SPRINT 1.1: The Boilerplate & Database LayerGoal: Initialize the Go module and establish the SQLite schema with migration support.Task T-101: Project Structure & Go ModuleDescription: Create the directory structure and initialize the module.Paths:services/sentinel/cmd/sentinel/main.goservices/sentinel/internal/kernel/services/sentinel/internal/state/Instructions:Initialize go mod init github.com/TheArchitectit/agent-guardrails-template/services/sentinel.Add dependencies: go get modernc.org/sqlite and github.com/mark3labs/mcp-go.Create a main.go that simply prints "Sentinel Kernel v0.1 Booting" and exits.Create a Makefile with targets: build, test, clean.Acceptance Criteria:go build produces a binary in ../../bin/sentinel.The binary runs without panic.Task T-102: The SQLite Store & MigratorDescription: Implement the persistent storage layer.Context: See docs/SENTINEL_CORE_ARCH.md Section 3.1.Instructions:Create internal/state/store.go.Implement NewStore(path string) which opens the DB using modernc.org/sqlite.Implement a Migrate() function that ensures the following tables exist:CREATE TABLE schema_version (version INTEGER);
CREATE TABLE system_config (key TEXT PRIMARY KEY, value TEXT);
CREATE TABLE sprints (id TEXT PRIMARY KEY, status TEXT, created_at DATETIME);
CREATE TABLE tasks (id TEXT PRIMARY KEY, sprint_id TEXT, status TEXT, title TEXT);
CREATE TABLE audit_log (id INTEGER PRIMARY KEY, timestamp DATETIME, action TEXT, payload JSON);
Use WAL mode: PRAGMA journal_mode=WAL;.Acceptance Criteria:A test case TestNewStore creates a temp DB file and verifies tables are created.Re-running NewStore on an existing DB does not error (Idempotency).Task T-103: The Audit Logger implementationDescription: We need a logger that writes to both Stderr and the SQLite DB.Context: See docs/SENTINEL_ARCH.md "The Audit Vault".Instructions:Create internal/audit/logger.go.Define struct Logger holding a *sql.DB and *log.Logger.Implement LogEvent(actor, action, severity string, payload map[string]interface{}).CRITICAL: Implement ScrubPII(input string) string helper using regex for sk-[a-z0-9]+ and AKIA.... Ensure this runs before DB insertion.Acceptance Criteria:LogEvent inserts a row into audit_log.A string containing "sk-1234567890abcdef" is saved as "[REDACTED]" in the DB.SPRINT 1.2: The VFS Jail (Security Kernel)Goal: Implement the filesystem abstraction that prevents the agent from escaping the repo.Task T-104: Path Sanitization LogicDescription: The core security function ValidatePath.Context: docs/SENTINEL_THREAT_MODEL.md Section 4.2.Instructions:Create internal/kernel/jail.go.Define struct Jailor with field Root string.Implement ValidatePath(requested string) (string, error).Use filepath.Abs and filepath.Clean.Verify strings.HasPrefix(cleanPath, jailor.Root).Check against a DenyList (Regex): \.git, \.env, id_rsa.Acceptance Criteria:Test ValidatePath("../../../etc/passwd") returns Error.Test ValidatePath(".env") returns Error.Test ValidatePath("src/main.go") returns Success + Absolute Path.Task T-105: Safe IO WrappersDescription: Convenience methods for reading/writing that enforce the Jail.Instructions:Implement Jailor.ReadFile(path string) ([]byte, error).Implement Jailor.WriteFile(path string, data []byte) error.Ensure WriteFile creates intermediate directories (MkdirAll).Constraint: WriteFile must check if file is "ReadOnly" in sentinel.toml (Mock this config lookup for now).Acceptance Criteria:Writing to foo/bar/baz.txt creates directories foo/bar.Writing to a file outside root fails.SPRINT 1.3: The MCP Transport LayerGoal: Connect the Kernel to the outside world via JSON-RPC.Task T-106: MCP Server BootstrapDescription: Initialize the mark3labs/mcp-go server.Context: services/sentinel/internal/api/mcp_registry.go.Instructions:Create internal/api/server.go.Function NewServer(kernel *kernel.Kernel) *server.MCPServer.Configure it with server.WithLogging() for debug visibility.Implement ServeStdio() wrapper in main.go.Acceptance Criteria:Running ./sentinel serve keeps the process alive waiting for JSON input.Task T-107: Basic Tools Implementation (Read/Write)Description: Wire the Jailor methods to MCP Tools.Instructions:Register tool read_file -> Calls Jailor.ReadFile.Register tool write_file -> Calls Jailor.WriteFile.Register tool list_files -> Walks the directory tree (respecting .gitignore if possible, or just skipping .git).Acceptance Criteria:Can interact with the binary via a generic MCP client (e.g., Inspector).Calling read_file works.Calling read_file on a blocked path returns a JSON-RPC Error (not a crash).1.4 Phase 1 Review ChecklistBefore moving to Phase 2, verify:[ ] Binary compiles on Linux/Mac/Windows (GOOS=windows go build).[ ] state.db is created on first run.[ ] Audit log captures every write_file attempt.[ ] Attempting to write ../../hack.sh fails gracefully.[ ] PII redaction works on log output.End of Phase 1 Plan.