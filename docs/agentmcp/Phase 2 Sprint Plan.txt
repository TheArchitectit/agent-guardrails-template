Project Sentinel: Phase 2 - Logic & ToolingTarget Agent: Autonomous Developer (Systems & DevOps Focus)Total Estimated Tokens: 150kOutput Artifact: Full-featured MCP ServerPrerequisites: Phase 1 Complete (Binary runs, DB works)SPRINT 2.1: The Polyglot Toolchain EngineGoal: Allow the Agent to run tests and builds without knowing the underlying OS commands.Task T-201: Language Detection HeuristicsDescription: Logic to identify if the repo is Go, TS, Python, etc.Context: docs/setup/SENTINEL_POLYGLOT.md.Instructions:Create internal/toolchain/detector.go.Implement DetectLanguage(root string) (Profile, error).Logic:go.mod -> Go Profile.package.json -> Node Profile (Check lockfiles for npm/pnpm/yarn).pom.xml -> Java Profile.Acceptance Criteria:Running on this repo returns Profile{Name: "go"}.Task T-202: The Command Abstraction LayerDescription: Map abstract intents to concrete commands.Instructions:Define struct Profile with fields TestCmd, BuildCmd, LintCmd.Create internal/toolchain/executor.go.Implement Execute(ctx, cmd []string) (output string, err error).Crucial: Implement SanitizeEnv() to strip AWS_SECRET_KEY etc. from the child process environment unless explicitly allowlisted.Acceptance Criteria:Execute runs go version successfully.Environment variables are scrubbed.Task T-203: The run_tests ToolDescription: Expose the logic via MCP.Instructions:Register run_tests tool.Logic: Detect language -> Get TestCmd -> executor.Execute.If output contains "FAIL" or exit code != 0, return ToolResult with Error severity (but successful execution).Acceptance Criteria:Calling run_tests on a broken Go project returns the compiler error in the tool output.SPRINT 2.2: Workflow & State EnforcementGoal: Implement the "Manager" logic that forces the Agent to follow the SDLC.Task T-204: Sprint & Task CRUDDescription: DB operations for Sprints.Context: docs/sprints/SENTINEL_SPRINT_GOVERNANCE.md.Instructions:Implement Kernel.StartSprint(name, goals string).Implement Kernel.AddTask(title string).Implement Kernel.CompleteTask(id string).Constraint: StartSprint fails if CurrentState != IDLE.Acceptance Criteria:Can create a sprint and see it in the sprints table.Can add tasks linked to that sprint.Task T-205: Git Integration (The Wrapper)Description: Secure Git operations.Context: docs/workflows/SENTINEL_WORKFLOW_COMMIT.md.Instructions:Create internal/git/wrapper.go.Implement Commit(msg string).Validate msg against Regex ^(feat|fix|...).Fail if validation error.Implement Push(branch string).Fail if branch == "main".Acceptance Criteria:Commit with message "wip" fails.Push to "main" fails.Task T-206: The "Definition of Done" GateDescription: Logic to prevent closing tasks prematurely.Instructions:In CompleteTask, add a check:Has git status been checked? (Repo clean).Have tests passed in the last 15 minutes? (Query Audit Log).If check fails, return error: "DoD Violation".Acceptance Criteria:Trying to complete a task without running tests returns a blocking error.SPRINT 2.3: Cost Guardrails (The CFO)Goal: Prevent API bill shock.Task T-207: The Token EstimatorDescription: Offline token counting.Context: services/sentinel/internal/cost/estimator.go.Instructions:Create internal/cost/estimator.go.Implement EstimateTokens(text string) int. Use the heuristic words * 1.3.Implement EstimateFileCost(path string, pricePerM float64) float64.Acceptance Criteria:Returns reasonable estimates for text files.Task T-208: The Budget LedgerDescription: Tracking spend.Context: services/sentinel/internal/cost/ledger.go.Instructions:Create cost_transactions table in DB.Implement Ledger.RecordSpend(taskID string, input, output int).Implement Ledger.CheckBudget(estimated float64) error.Query total spend for today.If total + estimated > DailyLimit, return error.Acceptance Criteria:If Daily Limit is set to $0.01, running a large tool call gets blocked.Task T-209: Middleware IntegrationDescription: Hook the cost checks into the MCP handler.Instructions:In mcp_registry.go, wrap the read_file handler.Before reading, call Estimator.EstimateFileCost.Call Ledger.CheckBudget.If error, return ToolResultError("Budget Exceeded").Acceptance Criteria:read_file("large.log") fails if budget is low.2.4 Phase 2 Review Checklist[ ] run_tests works for Go and Python projects.[ ] git_commit rejects bad messages.[ ] start_task updates the DB state.[ ] Cost limits are enforced on file reads.[ ] archive_sprint successfully closes the loop.End of Phase 2 Plan.