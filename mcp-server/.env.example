# Guardrail MCP Server Environment Configuration
# Copy this file to .env and fill in the values
#
# Quick Start:
#   cp .env.example .env
#   # Edit .env with your actual values
#
# Configuration Schema Version: 1.0

# =============================================================================
# Schema Version (for migration tracking)
# =============================================================================
CONFIG_SCHEMA_VERSION=1.0

# =============================================================================
# Server Configuration
# =============================================================================
MCP_PORT=8080
WEB_PORT=8081
WEB_ENABLED=true
LOG_LEVEL=info
REQUEST_TIMEOUT=30s
SHUTDOWN_TIMEOUT=30s

# =============================================================================
# CORS Configuration (Web UI)
# =============================================================================
# Comma-separated list of allowed origins
# SECURITY: Use specific origins in production (e.g., "https://app.example.com")
# Default "*" allows all origins - NOT recommended for production
CORS_ALLOWED_ORIGINS=*
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-ID
CORS_MAX_AGE=86400

# =============================================================================
# Profiling (disable in production)
# =============================================================================
PPROF_ENABLED=false
PPROF_PORT=6060

# =============================================================================
# Health Check Configuration
# =============================================================================
HEALTH_CHECK_TIMEOUT=3s

# =============================================================================
# Database Configuration
# =============================================================================
DB_HOST=localhost
DB_PORT=5432
DB_NAME=guardrails
DB_USER=guardrail
DB_PASSWORD=change_me_in_production
DB_SSLMODE=disable

# Connection Pool Settings
DB_CONNECT_TIMEOUT=10s
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
DB_CONN_MAX_LIFETIME=30m
DB_CONN_MAX_IDLE_TIME=10m

# =============================================================================
# Redis Configuration
# =============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=change_me_in_production
REDIS_USE_TLS=false
REDIS_DB=0

# Connection Pool Settings
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=2
REDIS_MAX_RETRIES=3
REDIS_DIAL_TIMEOUT=5s
REDIS_READ_TIMEOUT=3s

# =============================================================================
# TLS Configuration (optional)
# =============================================================================
# Enable TLS for production deployments
TLS_ENABLED=false
TLS_CERT_PATH=/path/to/cert.pem
TLS_KEY_PATH=/path/to/key.pem
TLS_CA_PATH=/path/to/ca.pem
TLS_MIN_VERSION=1.3

# =============================================================================
# Security Configuration (REQUIRED - Generate strong random values)
# =============================================================================
# Generate with: openssl rand -hex 32
MCP_API_KEY=generate_a_32_byte_random_key_here
IDE_API_KEY=generate_a_different_32_byte_random_key_here

# =============================================================================
# JWT Configuration (REQUIRED)
# =============================================================================
# Generate with: openssl rand -hex 64
JWT_SECRET=generate_a_64_byte_random_secret_here_for_jwt_signing
JWT_ISSUER=guardrail-mcp
JWT_EXPIRY=15m
JWT_ROTATION_HOURS=168

# =============================================================================
# Rate Limiting Configuration
# =============================================================================
# Rate limits (requests per window)
# MCP API rate limit (higher for MCP tool calls)
RATE_LIMIT_MCP=1000
# IDE API rate limit (moderate for IDE integration)
RATE_LIMIT_IDE=500
# Per-session rate limit (lower to prevent abuse)
RATE_LIMIT_SESSION=100

# Rate limit window duration
RATE_LIMIT_WINDOW=1m

# Burst factor (allows temporary spikes: burst = limit * factor)
# Range: 1.0-5.0, higher values allow more burst traffic
RATE_LIMIT_BURST_FACTOR=1.5

# =============================================================================
# Cache TTL Configuration
# =============================================================================
# TTL for cached rules (active rules list)
CACHE_TTL_RULES=5m
# TTL for cached documents (project context, guidelines)
CACHE_TTL_DOCS=10m
# TTL for search result caches
CACHE_TTL_SEARCH=2m

# =============================================================================
# Feature Flags (can be hot-reloaded without restart)
# =============================================================================
# Toggle validation endpoint
ENABLE_VALIDATION=true
# Toggle metrics collection and /metrics endpoint
ENABLE_METRICS=true
# Toggle audit logging (recommended for production)
ENABLE_AUDIT_LOGGING=true
# Toggle Redis caching
ENABLE_CACHE=true

# =============================================================================
# Audit Logging Configuration
# =============================================================================
# Buffer size for audit log entries (100-10000)
AUDIT_BUFFER_SIZE=1000
# Flush interval for audit logs (1s-60s)
AUDIT_FLUSH_INTERVAL=5s
AUDIT_FLUSH_INTERVAL=5s

# =============================================================================
# Build Information (set automatically during build)
# =============================================================================
VERSION=dev
BUILD_TIME=unknown
GIT_COMMIT=unknown
