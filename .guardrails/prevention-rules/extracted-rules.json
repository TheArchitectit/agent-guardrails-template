{
  "$schema": "./pattern-rules.schema.json",
  "description": "Actionable rules extracted from AGENT_GUARDRAILS.md",
  "version": "1.0.0",
  "source": "docs/AGENT_GUARDRAILS.md",
  "rules": [
    {
      "rule_id": "PREVENT-GIT-001",
      "failure_id": null,
      "name": "No Force Push",
      "enabled": true,
      "pattern": "git\\s+push\\s+--force(?!-with-lease)",
      "forbidden_context": null,
      "message": "Force push without lease is prohibited by guardrails - can cause data loss and history corruption",
      "severity": "error",
      "category": "git",
      "file_glob": ["*"],
      "suggestion": "Use 'git push --force-with-lease' instead, or ask for explicit permission"
    },
    {
      "rule_id": "PREVENT-GIT-002",
      "failure_id": null,
      "name": "No Hard Reset",
      "enabled": true,
      "pattern": "git\\s+reset\\s+--hard",
      "forbidden_context": null,
      "message": "Hard reset can destroy uncommitted work and is prohibited on shared branches",
      "severity": "error",
      "category": "git",
      "file_glob": ["*"],
      "suggestion": "Use 'git stash' or commit changes first. If needed, ask for explicit permission"
    },
    {
      "rule_id": "PREVENT-GIT-003",
      "failure_id": null,
      "name": "No Config Changes",
      "enabled": true,
      "pattern": "git\\s+config",
      "forbidden_context": null,
      "message": "Modifying git config is prohibited - can cause security/identity issues",
      "severity": "error",
      "category": "git",
      "file_glob": ["*"],
      "suggestion": "Do not modify git configuration in automated operations"
    },
    {
      "rule_id": "PREVENT-GIT-004",
      "failure_id": null,
      "name": "No Amend Without Permission",
      "enabled": true,
      "pattern": "git\\s+commit\\s+.*--amend",
      "forbidden_context": null,
      "message": "Amending commits you didn't create this session breaks collaborator history",
      "severity": "warning",
      "category": "git",
      "file_glob": ["*"],
      "suggestion": "Only amend commits created in current session, or ask for explicit permission"
    },
    {
      "rule_id": "PREVENT-GIT-005",
      "failure_id": null,
      "name": "No Skip Hooks",
      "enabled": true,
      "pattern": "--no-verify|--no-gpg-sign",
      "forbidden_context": null,
      "message": "Skipping hooks bypasses safety checks and is prohibited",
      "severity": "error",
      "category": "git",
      "file_glob": ["*"],
      "suggestion": "Run all hooks. If hooks fail, fix the underlying issue"
    },
    {
      "rule_id": "PREVENT-GIT-006",
      "failure_id": null,
      "name": "No Rebase on Shared Branches",
      "enabled": true,
      "pattern": "git\\s+rebase",
      "forbidden_context": null,
      "message": "Rebasing shared branches destroys collaborator work",
      "severity": "error",
      "category": "git",
      "file_glob": ["*"],
      "suggestion": "Use merge instead, or only rebase local branches that haven't been pushed"
    },
    {
      "rule_id": "PREVENT-SYS-001",
      "failure_id": null,
      "name": "No Dangerous RM-RF",
      "enabled": true,
      "pattern": "rm\\s+-rf\\s+/",
      "forbidden_context": null,
      "message": "CRITICAL: Dangerous deletion pattern detected - can destroy system",
      "severity": "critical",
      "category": "system",
      "file_glob": ["*"],
      "suggestion": "Never use rm -rf on system directories. Verify path carefully"
    },
    {
      "rule_id": "PREVENT-SEC-001",
      "failure_id": null,
      "name": "No Secrets in Code",
      "enabled": true,
      "pattern": "(password|secret|api_key|token|private_key|access_key)\\s*[=:]\\s*[\"'][^\"']{8,}[\"']",
      "forbidden_context": "(example|placeholder|test|mock|dummy|fake|env\\.|process\\.env|os\\.getenv)",
      "message": "Possible hardcoded credential detected - secrets must not be committed",
      "severity": "critical",
      "category": "security",
      "file_glob": ["*"],
      "suggestion": "Use environment variables or secret management system"
    },
    {
      "rule_id": "PREVENT-SEC-002",
      "failure_id": null,
      "name": "No Production DB in Tests",
      "enabled": true,
      "pattern": "(production|prod)\\s*(db|database|conn|connection)",
      "forbidden_context": "(test|spec|_test\\.|_spec\\.)",
      "message": "Test code may be using production database - CRITICAL violation",
      "severity": "critical",
      "category": "security",
      "file_glob": ["*test*", "*spec*"],
      "suggestion": "Use separate test database. Never connect tests to production DB"
    },
    {
      "rule_id": "PREVENT-SCOPE-001",
      "failure_id": null,
      "name": "Check Failure Registry",
      "enabled": true,
      "pattern": "PRE-WORK-CHECK-SKIPPED",
      "forbidden_context": null,
      "message": "Pre-work regression check must be performed before modifying files",
      "severity": "warning",
      "category": "process",
      "file_glob": ["*"],
      "suggestion": "Read .guardrails/pre-work-check.md and check failure registry"
    }
  ]
}
